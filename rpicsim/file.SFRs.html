<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
<title>
  File: SFRs
  
    &mdash; Documentation by YARD 0.8.7.3
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    
        <a href="_index.html">Index</a> &raquo;
        
        <a href="file.Manual.html">RPicSim manual</a> &raquo;
    
    <span class="title">File: SFRs</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><div id='filecontents'>
<h1 id="label-SFRs">SFRs</h1>

<p>The Special Function Registers (SFRs) on a microcontroller enable the
firmware to interact with the microcontroller's peripherals and talk to the
outside world. RPicSim supports reading and writing these SFRs from Ruby.
This can be useful if you want to put your PIC into a particular state and
see how a part of your firmware responds. Each SFR is represented as an
instance of the <span class='object_link'><a href="RPicSim/Register.html" title="RPicSim::Register (class)">RPicSim::Register</a></span> class.</p>

<h2 id="label-Getting+a+Register+object">Getting a Register object</h2>

<p>The <span class='object_link'><a href="RPicSim/Sim.html#sfr-instance_method" title="RPicSim::Sim#sfr (method)">RPicSim::Sim#sfr</a></span> method can be called on your simulation object to
retrieve a <span class='object_link'><a href="RPicSim/Register.html" title="RPicSim::Register (class)">RPicSim::Register</a></span> object:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_sim'>sim</span><span class='period'>.</span><span class='id identifier rubyid_sfr'>sfr</span><span class='lparen'>(</span><span class='symbol'>:LATA</span><span class='rparen'>)</span>  <span class='comment'># =&gt; returns a Register object
</span></code></pre>

<p>If you are using RPicSim's <a href="file.RSpecIntegration.html" title="RSpec integration">RSpec integration</a>,
the <code>sfr</code> method inside an example automatically redirects to
the <code>@sim</code> object:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>works</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_sfr'>sfr</span><span class='lparen'>(</span><span class='symbol'>:LATA</span><span class='rparen'>)</span>  <span class='comment'># =&gt; returns a Register object
</span><span class='kw'>end</span>
</code></pre>

<p>The first argument of <span class='object_link'><a href="RPicSim/Sim.html#sfr-instance_method" title="RPicSim::Sim#sfr (method)">RPicSim::Sim#sfr</a></span> should be a symbol containing the
name of the SFR. The name comes from the MPLAB X code, but it should match
the name given in the microcontroller's datasheet.</p>

<h2 id="label-Using+a+register">Using a register</h2>

<p>Once you have obtained the <span class='object_link'><a href="RPicSim/Register.html" title="RPicSim::Register (class)">Register</a></span> object using one of
the methods above, you can read and write the value of the SFR using the
<code>value</code> attribute:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_sfr'>sfr</span><span class='lparen'>(</span><span class='symbol'>:LATA</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='int'>0x7B</span>
<span class='id identifier rubyid_expect'>expect</span><span class='lparen'>(</span><span class='id identifier rubyid_sfr'>sfr</span><span class='lparen'>(</span><span class='symbol'>:LATA</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_eq'>eq</span> <span class='int'>0x7B</span></code></pre>

<h2 id="label-Protected+bits">Protected bits</h2>

<p>When you write to the register with <span class='object_link'><a href="RPicSim/Register.html#value%3D-instance_method" title="RPicSim::Register#value= (method)">RPicSim::Register#value=</a></span>, you are
probably writing to it in the same way that the simulated microcontroller
would write to it. This means that some bits might not be writable or might
have restrictions on what value can be written to them. For example, the TO
and PD bits of the STATUS register on the PIC10F322 are not writable by the
microcontroller.</p>

<p>To get around this, you can use <span class='object_link'><a href="RPicSim/Register.html#memory_value%3D-instance_method" title="RPicSim::Register#memory_value= (method)">RPicSim::Register#memory_value=</a></span> instead,
which should allow you to write to any of the bits.</p>

<h2 id="label-Peripheral+updating">Peripheral updating</h2>

<p>The MPLAB X code contains various objects that simulate the peripherals on
a chip, such as the ADC. It has not been determined whether writing to SFRs
using the <span class='object_link'><a href="RPicSim/Register.html" title="RPicSim::Register (class)">RPicSim::Register</a></span> object updates the simulation of those
peripherals in the proper way. Also, whether the peripherals get updated
might depend on whether the <code>value</code> or the
<code>memory_value</code> attribute is used for writing.</p>

<h2 id="label-Non-memory-mapped+registers">Non-memory-mapped registers</h2>

<p>The MPLAB X code considers "SFRs" to only be the special registers that
have an address in memory. The special registers without a memory address
are called Non-Memory-Mapped Registers (NMMRs). To access these registers,
you can use <span class='object_link'><a href="RPicSim/Sim.html#nmmr-instance_method" title="RPicSim::Sim#nmmr (method)">RPicSim::Sim#nmmr</a></span> which is similar to <span class='object_link'><a href="RPicSim/Sim.html#sfr-instance_method" title="RPicSim::Sim#sfr (method)">RPicSim::Sim#sfr</a></span>.</p>

<p>On some chips, WREG and STKPTR are SFRs and on other chips they are NMMRs.
To make it easier to access these two registers, RPicSim provides the
methods <span class='object_link'><a href="RPicSim/Sim.html#wreg-instance_method" title="RPicSim::Sim#wreg (method)">RPicSim::Sim#wreg</a></span> and <span class='object_link'><a href="RPicSim/Sim.html#stkptr-instance_method" title="RPicSim::Sim#stkptr (method)">RPicSim::Sim#stkptr</a></span>. Those methods can be
called directly in RSpec examples thanks to RPicSim's
<a href="file.RSpecIntegration.html" title="RSpec integration">RSpec integration</a>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sets W to 5</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_expect'>expect</span><span class='lparen'>(</span><span class='id identifier rubyid_wreg'>wreg</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_eq'>eq</span> <span class='int'>5</span>
<span class='kw'>end</span></code></pre>

<p>To access other registers without worrying about what type they are, you
can use <span class='object_link'><a href="RPicSim/Sim.html#sfr_or_nmmr-instance_method" title="RPicSim::Sim#sfr_or_nmmr (method)">RPicSim::Sim#sfr_or_nmmr</a></span>.</p>
</div></div>

    <div id="footer">
  
    This is part of the <a href="file.Manual.html">RPicSim manual</a>.
  
  <br/><br/>

  Generated on Mon Feb 17 17:33:48 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.3 (ruby-1.9.3).
</div>

  </body>
</html>