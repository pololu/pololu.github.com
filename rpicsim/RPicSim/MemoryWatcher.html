<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: RPicSim::MemoryWatcher
  
    &mdash; Documentation by YARD 0.9.19
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "RPicSim::MemoryWatcher";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (M)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../RPicSim.html" title="RPicSim (module)">RPicSim</a></span></span>
     &raquo; 
    <span class="title">MemoryWatcher</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: RPicSim::MemoryWatcher
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">RPicSim::MemoryWatcher</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/rpicsim/memory_watcher.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>This class can attach to an MPLAB X memory class and watch for changes in
it, and report those changes as a hash associating variable names to new
values.  This is very useful for writing tests that assert that not only
were the desired variables written to, but also that no other variables
were written to.</p>

<p>This class does not analyze the current instruction being executed; it uses
the Attach method of the MPLAB X memory classes.  This means that it
doesn&#39;t work properly in some versions of MPLAB X.  See
<a href="../file.Flaws.html" title="Flaws">Flaws</a>.</p>


  </div>
</div>
<div class="tags">
  

</div>



  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#var_names_ignored-instance_method" title="#var_names_ignored (instance method)">#<strong>var_names_ignored</strong>  &#x21d2; Array(Symbol) </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Allows you to read or write the list of variable names whose changes will
be ignored.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clear-instance_method" title="#clear (instance method)">#<strong>clear</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Clears the record of what variables have been written to.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(sim, memory, vars)  &#x21d2; MemoryWatcher </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Creates a new instance.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#writes-instance_method" title="#writes (instance method)">#<strong>writes</strong>  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Generate a nice report of what variables have been written to since the
last time <span class='object_link'><a href="#clear-instance_method" title="RPicSim::MemoryWatcher#clear (method)">#clear</a></span> was called.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(sim, memory, vars)  &#x21d2; <tt><span class='object_link'><a href="" title="RPicSim::MemoryWatcher (class)">MemoryWatcher</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Creates a new instance.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>sim</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Sim.html" title="RPicSim::Sim (class)">Sim</a></span></tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>memory</span>
      
      
        <span class='type'>(<tt><span class='object_link'>Mplab::MplabMemory</span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The memory to watch</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>vars</span>
      
      
        <span class='type'>(<tt>Array(<span class='object_link'><a href="Variable.html" title="RPicSim::Variable (class)">Variable</a></span>)</tt>)</span>
      
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rpicsim/memory_watcher.rb', line 27</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_sim'>sim</span><span class='comma'>,</span> <span class='id identifier rubyid_memory'>memory</span><span class='comma'>,</span> <span class='id identifier rubyid_vars'>vars</span><span class='rparen'>)</span>
  <span class='comment'># Populate the @vars_by_address instance hash
</span>  <span class='ivar'>@vars_by_address</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_vars'>vars</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_var'>var</span><span class='op'>|</span>
    <span class='id identifier rubyid_var'>var</span><span class='period'>.</span><span class='id identifier rubyid_addresses'>addresses</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_address'>address</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='ivar'>@vars_by_address</span><span class='lbracket'>[</span><span class='id identifier rubyid_address'>address</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Variable %s overlaps with %s at 0x%x</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span>
          <span class='lbracket'>[</span><span class='id identifier rubyid_var'>var</span><span class='comma'>,</span> <span class='ivar'>@vars_by_address</span><span class='lbracket'>[</span><span class='id identifier rubyid_address'>address</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_address'>address</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>
      <span class='ivar'>@vars_by_address</span><span class='lbracket'>[</span><span class='id identifier rubyid_address'>address</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_var'>var</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='ivar'>@sim</span> <span class='op'>=</span> <span class='id identifier rubyid_sim'>sim</span>
  <span class='ivar'>@memory</span> <span class='op'>=</span> <span class='id identifier rubyid_memory'>memory</span>
  <span class='ivar'>@memory</span><span class='period'>.</span><span class='id identifier rubyid_on_change'>on_change</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_ar'>ar</span><span class='op'>|</span> <span class='id identifier rubyid_handle_change'>handle_change</span><span class='lparen'>(</span><span class='id identifier rubyid_ar'>ar</span><span class='rparen'>)</span> <span class='rbrace'>}</span>

  <span class='ivar'>@vars_written</span> <span class='op'>=</span> <span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@var_names_ignored</span> <span class='op'>=</span> <span class='id identifier rubyid_default_var_names_ignored'>default_var_names_ignored</span><span class='lparen'>(</span><span class='id identifier rubyid_sim'>sim</span><span class='period'>.</span><span class='id identifier rubyid_device'>device</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="var_names_ignored=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="var_names_ignored-instance_method">
  
    #<strong>var_names_ignored</strong>  &#x21d2; <tt>Array(Symbol)</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Allows you to read or write the list of variable names whose changes will
be ignored.  By default, this includes registers like WREG and STATUS that
change a lot.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array(Symbol)</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


21
22
23</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rpicsim/memory_watcher.rb', line 21</span>

<span class='kw'>def</span> <span class='id identifier rubyid_var_names_ignored'>var_names_ignored</span>
  <span class='ivar'>@var_names_ignored</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="clear-instance_method">
  
    #<strong>clear</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Clears the record of what variables have been written to.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


67
68
69</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rpicsim/memory_watcher.rb', line 67</span>

<span class='kw'>def</span> <span class='id identifier rubyid_clear'>clear</span>
  <span class='ivar'>@vars_written</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="writes-instance_method">
  
    #<strong>writes</strong>  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Generate a nice report of what variables have been written to since the
last time <span class='object_link'><a href="#clear-instance_method" title="RPicSim::MemoryWatcher#clear (method)">#clear</a></span> was called.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A hash where the keys are names (as symbols) of variables that were written
to, and the value is the variable&#39;s current value. If an address was
written to that does not correspond to a variable, the key for that will
just be address as an integer.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


54
55
56
57
58
59
60
61
62
63
64</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rpicsim/memory_watcher.rb', line 54</span>

<span class='kw'>def</span> <span class='id identifier rubyid_writes'>writes</span>
  <span class='id identifier rubyid_hash'>hash</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@vars_written</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_var'>var</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_var'>var</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Integer</span>
      <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_var'>var</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@memory</span><span class='period'>.</span><span class='id identifier rubyid_read_word'>read_word</span><span class='lparen'>(</span><span class='id identifier rubyid_var'>var</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_var'>var</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_var'>var</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_hash'>hash</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  
  <br/><br/>

  Generated on Wed Apr 17 15:05:27 2019 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.19 (ruby-2.5.3).
</div>

    </div>
  </body>
</html>