<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>AMIS30543 library: README.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">AMIS30543 library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">README.md</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# AMIS-30543 library for Arduino</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Version: 1.0.0&lt;br/&gt;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Release date: 2015 May 21&lt;br/&gt;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;[www.pololu.com](https://www.pololu.com/)</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;## Summary</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;This is a C++ library for the Arduino IDE that helps interface with an [AMIS-30543 micro-stepping stepper motor driver](https://www.pololu.com/product/2970).  It uses the [Arduino SPI](http://www.arduino.cc/en/Reference/SPI) library to communicate with the SPI interface (CS, DO, DI, and CLK) of the AMIS-30543.</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;## Supported platforms</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;This library is designed to work with the Arduino IDE versions 1.6.x or later and will probably not work with older versions.  For instance, it does not work with version 1.0.6.  This library supports any Arduino-compatible board, including the [Pololu A-Star 32U4 controllers](https://www.pololu.com/category/149/a-star-programmable-controllers).</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;## Getting started</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;### Hardware</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;An [AMIS-30543 carrier](https://www.pololu.com/product/2970) can be purchased from Pololu&#39;s website.  Before continuing, careful reading of the [product page](https://www.pololu.com/product/2970) as well as the AMIS-30543 datasheet is recommended.</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;You will need to connect your motor, motor power, and IOREF as described on the product page.  You should also make the following connections between the Arduino and the driver:</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    Arduino pin 6   - driver DIR</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    Arduino pin 5   - driver STEP</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    Arduino pin 4   - driver CS</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    Arduino SCK     - driver CLK</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    Arduino MOSI    - driver DI</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    Arduino MISO    - driver DO</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    Arduino GND     - driver GND</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;The DO pin is only needed if you want to read information back from the stepper driver.  The DIR pin is also optional and not used in every example.</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;The SPI pins (MOSI, MISO, and SCK) on Arduino-compatible boards are sometimes not labeled.  You should refer to the documentation for your particular board to find the locations of these pins.</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;On the [Arduino Uno](https://www.pololu.com/product/2191), [Arduino Leonardo](https://www.pololu.com/product/2192), and the [A-Star 32U4 controllers](https://www.pololu.com/category/149/a-star-programmable-controllers), the SPI pins (SCK, MOSI, and MISO) can be found on the 6-pin ISP header.</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;The [Arduino Uno](https://www.pololu.com/product/2191) has additional access points for the SPI pins: pin 11 is MOSI, pin 12 is MISO, and pin 13 is SCK.</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;### Software</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;If you are using version 1.6.2 or later of the [Arduino IDE](http://www.arduino.cc/en/Main/Software), you can use the Library Manager to install this library:</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;1. In the Arduino IDE, open the &quot;Sketch&quot; menu, select &quot;Include Library&quot;, then &quot;Manage Libraries...&quot;.</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;2. Search for &quot;AMIS30543&quot;.</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;3. Click the AMIS30543 entry in the list.</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;4. Click &quot;Install&quot;.</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;If this does not work, you can manually install the library:</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;1. Download the [latest release archive from GitHub](https://github.com/pololu/amis-30543-arduino/releases) and decompress it.</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;2. Rename the folder &quot;amis-30543-arduino-xxxx&quot; to &quot;AMIS30543&quot;.</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;3. Drag the &quot;AMIS30543&quot; folder into the &quot;libraries&quot; directory inside your Arduino sketchbook directory.  You can view your sketchbook location by opening the **&quot;File&quot;** menu and selecting **&quot;Preferences&quot;** in the Arduino IDE.  If there is not already a &quot;libraries&quot; folder in that location, you should make the folder yourself.</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;4. After installing the library, restart the Arduino IDE.</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;## Examples</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;Several example sketches are available that show how to use the library. You can</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;access them from the Arduino IDE by opening the &quot;File&quot; menu, selecting</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;&quot;Examples&quot;, and then selecting &quot;AMIS30543&quot;. If you cannot find these</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;examples, the library was probably installed incorrectly and you should retry</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;the installation instructions above.</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;## Documentation</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;For complete documentation of this library, including many features that were</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;not mentioned here, see</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;[the amis-30543-arduino documentation](https://pololu.github.io/amis-30543-arduino/).</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;## Handling interruptions in stepper motor power</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;If the power supply to the AMIS-30543 drops too low, then the driver will turn off and the motor will stop moving.  After power is restored, all of the device&#39;s configuration registers will have their default values.  This means that the motor outputs will be off and the motor will not turn, even after power is restored.</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;It is possible to detect this situation using the `verifySettings()` function and/or recover from it using the `applySettings()` function.</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;The `verifySettings()` function reads all of the configuration registers from the driver and verifies that they match the previously-specified settings.  If `verifySettings()` returns false, then it means that the settings on the driver do not match the cached setting in the `AMIS30543` object, or the device is powered off, or the SPI connections between the microcontroller and the AMIS-30543 are incorrect.  If your SPI connections are correct and the `AMIS30543` object is on the part of your system that might modify the registers on the driver, then the most likely causes for `verifySettings()` returning false would be that the driver is not powered or it lost power at some point in the past.</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;The `applySettings()` function writes all of the cached settings to the driver.  If the power to the driver is interrupted and then restored, calling `applySettings()` can restore the desired settings to the device and allow it to run again.</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;The functions `sleep()`, `sleepStop()`, `setSlaGainDefault()`, `setSlaGainHalf()`, `setSlaTransparencyOff()`, `setSlaTransparencyOn()`, `disableDriver()`, and `enableDriver()` each modify bits in CR2, a register that also contains the bit that enables the motor driver outputs (MOTEN).  To help avoid operating the motor at incorrect settings, each of these functions includes a call to `applySettings()`.  When you call any of these functions, your system will automatically recover from earlier interruptions in the stepper motor power.  These functions might also make it hard for you to detect power interruptions by calling `verifySettings()`, because they might automatically fix the settings before `verifySettings()` gets called.</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;The AutoRecover example that comes with this library shows how to use `verifySettings()` to detect power loss and use `applySettings()` to recover from it.</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;## Detecting an open coil</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;**WARNING:** Disconnecting a stepper motor coil while the motor is operating can cause damage to the stepper motor driver or other parts of your system.  If you want to test that open coil detection is working, we recommend removing the connection while the stepper motor driver is not powered.</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;The AMIS-30543 has the ability to detect when current cannot flow through one of your stepper motor coils.  This is called an open coil, and it usually is caused by incorrect or incomplete connections between the stepper motor and the driver.  It can also be caused by setting a current limit that is too high to be reached with your choice of stepper motor and power supply.</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;The `readNonLatchedStatusFlags()` function reads the non-latched status flags from the device, including the OPENX and OPENY bits which indicate than an open coil condition has been detected.  The AutoRecover example that comes with this library shows how to use that function.</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;An open coil condition is only detected after a motor output PWM signal has been at a 100% duty cycle for 200 milliseconds.  Therefore, to detect an open coil, you will need to step the motor sufficiently slowly or you will need to pause the motor&#39;s movement for at least 200 ms occasionally.  When you pause, you should be sure to pause at a step position where the desired currents in both coils are non-zero.  Also, after detecting an open coil, you should avoid stepping the motor until the problem is resolved and the status flags change back to 0.  Taking steps during an open coil condition will usually cause the driver to stop detecting the open coil condition and clear the OPENX and OPENY bits.</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;## Version history</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;* 1.0.0 (2015 May 21): Original release.</div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu May 21 2015 20:32:58 for AMIS30543 library by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
